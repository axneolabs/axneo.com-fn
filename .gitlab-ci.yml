stages:

  - test
  - build
  - review
  - staging
  - deploy

test:

  stage: test
  script:
    - echo "Run Test"


build:

  stage: build
  script:
    - cd ~/axneo.com
    - git checkout $CI_BUILD_REF_NAME
    - git pull
    - docker-compose -f axneo.yml down
    - docker-compose -f axneo.yml up -d


deploy_review:

  stage: review

  script:
    - echo "test"

  environment:
    name: review/$CI_BUILD_REF_NAME
    url: https://review.axneo.com/$CI_BUILD_REF_NAME

  only:
    - branches

  except:
    - master

stop_review:

  variables:
    GIT_STRATEGY: none

  script:
    - echo "Remove review app"

  when: manual

  environment:
    name: review/$CI_BUILD_REF_NAME
    action: stop


deploy_staging:

  stage: staging

  script:
    - echo "Deploy to staging server"

  environment:
    name: staging
    url: https://staging.axneo.com

  when: manual

  only:
    - master


deploy_production:

  stage: deploy

  script:
    - echo "Deploy to production server"

  environment:
    name: production
    url: https://www.axneo.com

  when: manual

  only:
    - master